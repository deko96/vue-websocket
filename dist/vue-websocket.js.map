{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 024e6bd192923a77b3ad","webpack:///./src/index.js","webpack:///./src/VueWebsocket.js","webpack:///./src/config.js","webpack:///./src/core.js","webpack:///./src/EventEmmiter.js"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;;;;AC7DA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;;;;;;;;;;ACjBA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;;;;;;;;ACxMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;;;;;;;;ACbA;AACA;AACA;AACA;AACA;;;;;;;;ACJA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA,mBAAmB,YAAY;AAC/B;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA","file":"vue-websocket.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"VueWebSocket\"] = factory();\n\telse\n\t\troot[\"VueWebSocket\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 024e6bd192923a77b3ad","import VueWebSocket from './VueWebsocket';\n\nexport default {\n    install(Vue, options) {\n        let socket = new VueWebSocket(options);\n\n        Vue.prototype.$socket = socket.proto;\n\n        Vue.mixin({\n            beforeCreate: function () {\n                let handlers = this.$options[\"websocket\"];\n                if (handlers) {\n                    Object.keys(handlers).forEach(event => socket.handlers[event] = handlers[event]);\n                }\n            }\n        });\n    }\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/index.js\n// module id = 0\n// module chunks = 0","import config from './config';\nimport core from './core';\nimport EventEmitter from './EventEmmiter';\n\nexport default class VueWebSocket {\n    constructor(options) {\n        if (!options.url) {\n            throw new Error('[VueWebSocket] Cannot create VueWebSocket instance, without a wss URL!');\n        }\n        core.self = this;\n        this.options = Object.assign(config, options);\n        this.emitter = new EventEmitter();\n        this.socket = null;\n        this.connected = null;\n        this.handlers = {};\n        this.reconnectAttempts = 0;\n        if (this.options.autoConnect) this.open();\n    }\n\n    open() {\n        if (!this.connected) {\n            let url = this._parseUrl(this.options.url, this.options.queryString);\n            this.socket = new WebSocket(url);\n            this._bind();\n            if (this.options.debug) {\n                console.log('[VueWebSocket] Websocket connecting to %s', url);\n            }\n        } else {\n            this.close(3001, 'Connection Change');\n            if (this.options.debug) {\n                console.log('[VueWebSocket] Websocket instance already exists! Closing the current one, and opening a new one!');\n            }\n        }\n    }\n\n    close(code = null, reason = null) {\n        if (this.socket) {\n            this.socket.close(code, reason);\n        } else {\n            console.error('[VueWebSocket] Trying to close not initialized socket instance.');\n        }\n    }\n\n\n    send(event, data) {\n        if (!this.connected) {\n            if (this.options.debug) {\n                console.log('[VueWebSocket] Cannot send message while the WebSocket is not connected.')\n            }\n            return;\n        }\n        if (this.options.debug) {\n            console.log('[VueWebSocket] ws-out >>> %s', event, data);\n        }\n        this.socket.send(\n            JSON.stringify(\n                {\n                    event: event,\n                    data: data\n                }\n            )\n        )\n    }\n\n    setUrl(url, qs = undefined) {\n        if (!url) {\n            throw new Error('[VueWebSocket] URL Cannot be empty!');\n        }\n        if (qs !== undefined) {\n            this.options.queryString = qs;\n        }\n        this.url = url;\n    }\n\n    _reopen() {\n        if (this.options.reconnect) {\n            this.reconnectAttempts += 1;\n            setTimeout(this.open.bind(this), this.reconnectIn);\n            console.log('[VueWebSocket] Reconnecting in %ds', this.reconnectIn / 1000);\n        }\n    }\n\n    _bind() {\n        this.socket.onopen = this._onOpen.bind(this);\n        this.socket.onmessage = this._onData.bind(this);\n        this.socket.onerror = this._onError.bind(this);\n        this.socket.onclose = this._onClose;\n    }\n\n    _unbind() {\n        this.socket.removeEventListener('open', this._onOpen);\n        this.socket.removeEventListener('message', this._onData);\n        this.socket.removeEventListener('error', this._onError);\n        this.socket.removeEventListener('close', this._onClose);\n    }\n\n    _ping() {\n        this.send('ping', Date.now());\n        core.pongTimeout = setTimeout(() => {\n            if (this.options.debug) {\n                console.log('[VueWebSocket] WebSocket connection timed out!');\n            }\n            clearInterval(core.pingInterval);\n            this._unbind();\n            this.connected = null;\n            this.socket.retired = true;\n            this.close(3000, 'Forced Retiring!');\n        }, this.monitorTimeout);\n    }\n\n    _pong() {\n        clearTimeout(core.pongTimeout);\n    }\n\n    _onOpen(event) {\n        if (this.options.debug) {\n            console.log('[VueWebSocket] WebSocket connected to %s!', this.options.url);\n        }\n        this.connected = Date.now();\n        this.reconnectAttempts = 0;\n        if (this.options.monitor) core.pingInterval = setInterval(this._ping.bind(this), this.monitorInterval);\n        this.emitter.emit('open', event);\n        if (this.handlers['open']) this.handlers['open'](event);\n    }\n\n    _onError(event) {\n        if (this.options.debug) {\n            console.error('[VueWebSocket] WebSocket Error!', event);\n        }\n        this.emitter.emit('error', event);\n        if (this.handlers['error']) this.handlers['error'](event);\n    }\n\n    _onData({ data }) {\n        try {\n            data = JSON.parse(data);\n        }\n        catch(error) {\n            throw new Error('[VueWebSocket] Failed to parse data!');\n        }\n        if (this.options.debug) {\n            console.log('[VueWebSocket] ws-in <<< %s', data.event, data.data);\n        }\n        this._pong();\n        this.emitter.emit(data.event, data.data);\n        if (this.handlers[data.event]) this.handlers[data.event](data.data);\n    }\n\n    _onClose(event) {\n        if (!this.retired) {\n            let self = core.self;\n            if (event.code === 1006) {\n                self._reopen();\n            }\n            if (self.connected) {\n                self.connected = null;\n                if (self.options.monitor) {\n                    clearTimeout(core.pongTimeout);\n                    clearInterval(core.pingInterval);\n                }\n                if (event.code === 3001) {\n                    self.open();\n                }\n            }\n            self.emitter.emit('close', event);\n            if (self.handlers['close']) self.handlers['close'](event);\n        }\n    }\n\n    _parseUrl(url, qs = null) {\n        let wsCheck = url.indexOf('ws://') === -1;\n        if (wsCheck) url = ['ws', url].join('://');\n        if (qs) qs = new URLSearchParams(qs).toString();\n        return qs ? [url, qs].join('?') : url;\n    }\n\n    get monitorInterval() {\n        return this.options.monitor.interval * 1000;\n    }\n\n    get monitorTimeout() {\n        return this.options.monitor.timeout * 1000;\n    }\n\n    get reconnectIn() {\n        let reconnect = this.options.reconnect;\n        if (reconnect.interval) return reconnect.interval * 1000;\n        return this.reconnectAttempts < reconnect.maxTimeout ? this.reconnectAttempts * 1000 : reconnect.maxTimeout;\n    }\n\n    get proto() {\n        return {\n            open: this.open,\n            close: this.close,\n            send: this.send,\n            on: this.emitter.on,\n            once: this.emitter.once,\n            setUrl: this.setUrl\n        }\n    }\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/VueWebsocket.js\n// module id = 1\n// module chunks = 0","export default {\n    url: null,\n    queryString: null,\n    autoConnect: true,\n    reconnect: {\n        interval: null,\n        maxTimeout: 15\n    },\n    monitor: {\n        interval: 5,\n        timeout: 3\n    },\n    debug: false\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/config.js\n// module id = 2\n// module chunks = 0","export default {\n    self: null,\n    pingInterval: null,\n    pongTimeout: null\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/core.js\n// module id = 3\n// module chunks = 0","var EventEmitter = function () {\n    this.events = {};\n};\n\nEventEmitter.prototype.on = function (event, listener) {\n    if (typeof this.events[event] !== 'object') {\n        this.events[event] = [];\n    }\n\n    this.events[event].push(listener);\n};\n\nEventEmitter.prototype.removeListener = function (event, listener) {\n    var idx;\n\n    if (typeof this.events[event] === 'object') {\n        idx = indexOf(this.events[event], listener);\n\n        if (idx > -1) {\n            this.events[event].splice(idx, 1);\n        }\n    }\n};\n\nEventEmitter.prototype.emit = function (event) {\n    var i, listeners, length, args = [].slice.call(arguments, 1);\n\n    if (typeof this.events[event] === 'object') {\n        listeners = this.events[event].slice();\n        length = listeners.length;\n\n        for (i = 0; i < length; i++) {\n            listeners[i].apply(this, args);\n        }\n    }\n};\n\nEventEmitter.prototype.once = function (event, listener) {\n    this.on(event, function g () {\n        this.removeListener(event, g);\n        listener.apply(this, arguments);\n    });\n};\n\nexport default EventEmitter;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/EventEmmiter.js\n// module id = 4\n// module chunks = 0"],"sourceRoot":""}